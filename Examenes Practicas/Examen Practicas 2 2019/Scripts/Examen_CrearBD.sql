-- CICLISMO DE MONTAÑA BD --

-- TEMPORADAS DE CICLISMO DE MONTAÑA
CREATE TABLE TEMPORADA 
(
  ANO NUMBER NOT NULL,
  SISTEMA_PUNTOS VARCHAR2(50) NOT NULL,
  NUMERO_CARRERAS NUMBER NOT NULL, 
  CONSTRAINT TEMPORADA_PK PRIMARY KEY (ANO)
);

INSERT INTO TEMPORADA (ANO, SISTEMA_PUNTOS, NUMERO_CARRERAS) VALUES (2018, '(55,40,30,25,20,15,10,6,4,2)', 2);
INSERT INTO TEMPORADA (ANO, SISTEMA_PUNTOS, NUMERO_CARRERAS) VALUES (2019, '(60,45,30,25,20,15,10,5,3,2)', 2);

-- COMUNIDADES
CREATE TABLE COMUNIDAD
(
  COD_COMU CHAR(2) NOT NULL,
  NOMBRE_ESP VARCHAR2(100) NOT NULL,
  NOMBRE_EUS VARCHAR2(100) NOT NULL,
  CONSTRAINT COMU_PK PRIMARY KEY (COD_COMU)
);

INSERT INTO COMUNIDAD (COD_COMU, NOMBRE_ESP, NOMBRE_EUS) VALUES ('NA', 'Navarra','Nafarroa');
INSERT INTO COMUNIDAD (COD_COMU, NOMBRE_ESP, NOMBRE_EUS) VALUES ('RI', 'Rioja','Errioxa');
INSERT INTO COMUNIDAD (COD_COMU, NOMBRE_ESP, NOMBRE_EUS) VALUES ('AR', 'Aragon','Aragoi');

-- SEDES
CREATE TABLE SEDE (
  SEDE VARCHAR2(8) NOT NULL,
  LONGITUD NUMBER NOT NULL, 
  VUELTAS NUMBER NOT NULL,  
  COD_COMU CHAR(2) NOT NULL, 
  CATEGORIA VARCHAR2(8) NOT NULL, 
  CONSTRAINT CATEGORIA_CHK CHECK (CATEGORIA IN ('GENERAL', 'ESCUELAS')),
  CONSTRAINT SEDE_PK PRIMARY KEY (SEDE),
  CONSTRAINT SEDE_COMU_FK FOREIGN KEY (COD_COMU) REFERENCES COMUNIDAD (COD_COMU)
);

INSERT INTO SEDE (SEDE, LONGITUD, VUELTAS, COD_COMU, CATEGORIA) VALUES ('ARGUEDAS', 5600, 5, 'NA','GENERAL');
INSERT INTO SEDE (SEDE, LONGITUD, VUELTAS, COD_COMU, CATEGORIA) VALUES ('PERALTA', 7500, 4, 'NA','GENERAL');
INSERT INTO SEDE (SEDE, LONGITUD, VUELTAS, COD_COMU, CATEGORIA) VALUES ('OTEIZA', 6600, 5, 'NA','GENERAL');
INSERT INTO SEDE (SEDE, LONGITUD, VUELTAS, COD_COMU, CATEGORIA) VALUES ('LOGROÑO', 5000, 4, 'RI','GENERAL');

-- CARRERAS
CREATE TABLE CARRERA (
  ANO NUMBER NOT NULL,
  FECHA_CARRERA DATE NOT NULL,
  NOMBRE_CARRERA VARCHAR2(40), 
  VUELTAS NUMBER,
  SEDE VARCHAR2(8),
  CONSTRAINT CARRERAS_PK PRIMARY KEY (FECHA_CARRERA),
  CONSTRAINT CARRERAS_TEMPORADAS_FK FOREIGN KEY (ANO) REFERENCES TEMPORADA (ANO),
  CONSTRAINT CARRERAS_SEDES_FK FOREIGN KEY (SEDE) REFERENCES SEDE (SEDE)
);

INSERT INTO CARRERA (ANO, FECHA_CARRERA, NOMBRE_CARRERA, VUELTAS, SEDE) VALUES (2018, '14/10/2018','Open Villa de Peralta',4,'PERALTA');
INSERT INTO CARRERA (ANO, FECHA_CARRERA, NOMBRE_CARRERA, VUELTAS, SEDE) VALUES (2018, '21/10/2018','Clasica Villa de Arguedas',5, 'ARGUEDAS');
INSERT INTO CARRERA (ANO, FECHA_CARRERA, NOMBRE_CARRERA, VUELTAS, SEDE) VALUES (2019, '22/09/2019','XCO Ciudad de Logroño',4,'LOGROÑO');
INSERT INTO CARRERA (ANO, FECHA_CARRERA, NOMBRE_CARRERA, VUELTAS, SEDE) VALUES (2019, '29/09/2019','Open Villa de Peralta',4,'PERALTA');
INSERT INTO CARRERA (ANO, FECHA_CARRERA, NOMBRE_CARRERA, VUELTAS, SEDE) VALUES (2019, '27/10/2019','Trofeo Ciclos Lizarra', 5,'OTEIZA');

-- EQUIPOS
CREATE TABLE EQUIPO (
  CODIGO_EQ VARCHAR2(3) NOT NULL, 
  NOMBRE_EQ VARCHAR2(40) NOT NULL,
  COD_COMU CHAR(2) NOT NULL, 
  CATEGORIA VARCHAR2(100),  
  CONSTRAINT EQUIPO_PK PRIMARY KEY (CODIGO_EQ),
  CONSTRAINT EQUIPO_COMU_FK FOREIGN KEY (COD_COMU) REFERENCES COMUNIDAD (COD_COMU),
  CONSTRAINT EQUIPO_UQ UNIQUE (NOMBRE_EQ)
); 

INSERT INTO EQUIPO (CODIGO_EQ, NOMBRE_EQ, COD_COMU, CATEGORIA) VALUES ('POW','POWERBIKES CLUB DEPORTIVO', 'NA','MA-30');
INSERT INTO EQUIPO (CODIGO_EQ, NOMBRE_EQ, COD_COMU, CATEGORIA) VALUES ('SAR','SARRIBIKES CLUB DEPORTIVO', 'NA','ELITE');
INSERT INTO EQUIPO (CODIGO_EQ, NOMBRE_EQ, COD_COMU, CATEGORIA) VALUES ('EDE','EDELWEISS LAGUARTA BIKES', 'AR','F-M30');
INSERT INTO EQUIPO (CODIGO_EQ, NOMBRE_EQ, COD_COMU, CATEGORIA) VALUES ('CON','CONOR-SALTOKI', 'NA','F-ELI');

-- BIKERS
CREATE TABLE BIKER (
  COD_BIKER NUMBER NOT NULL, 
  NOMBRE VARCHAR2(100) NOT NULL, 
  COD_COMU CHAR(2) NOT NULL, 
  FECHA_NACIMIENTO DATE, 
  LUGAR_NACIMIENTO VARCHAR2(100), 
  SEXO CHAR(1) NOT NULL, 
  CONSTRAINT BIKER_PK PRIMARY KEY (COD_BIKER),
  CONSTRAINT BIKER_COMU_FK FOREIGN KEY (COD_COMU) REFERENCES COMUNIDAD (COD_COMU),
  CONSTRAINT SEXO_CHK CHECK (SEXO IN ('H', 'M'))
);

INSERT INTO BIKER (COD_BIKER, NOMBRE, FECHA_NACIMIENTO, COD_COMU, LUGAR_NACIMIENTO, SEXO) VALUES (1, 'Patxi Cia', '09/09/1978','NA', 'Lizaso', 'H');
INSERT INTO BIKER (COD_BIKER, NOMBRE, FECHA_NACIMIENTO, COD_COMU, LUGAR_NACIMIENTO, SEXO) VALUES (2, 'Diego Latasa', '20/06/1989', 'NA','Pamplona', 'H');
INSERT INTO BIKER (COD_BIKER, NOMBRE, FECHA_NACIMIENTO, COD_COMU, LUGAR_NACIMIENTO, SEXO) VALUES (3, 'Ander Elizagaray', '01/01/1985',  'NA','Arazuri', 'H');
INSERT INTO BIKER (COD_BIKER, NOMBRE, FECHA_NACIMIENTO, COD_COMU, LUGAR_NACIMIENTO, SEXO) VALUES (4, 'Cesar Manso', '31/12/1985', 'RI', 'Logroño', 'H');
INSERT INTO BIKER (COD_BIKER, NOMBRE, FECHA_NACIMIENTO, COD_COMU, LUGAR_NACIMIENTO, SEXO) VALUES (5, 'Lilian Soriano', '02/03/1981', 'AR', 'Zaragoza', 'M');
INSERT INTO BIKER (COD_BIKER, NOMBRE, FECHA_NACIMIENTO, COD_COMU, LUGAR_NACIMIENTO, SEXO) VALUES (6, 'Corina Mesplet', '03/04/1984', 'RI', 'Arnedo', 'M');

-- PERTENECE
CREATE TABLE PERTENECE (
  ANO NUMBER NOT NULL,
  COD_BIKER NUMBER NOT NULL, 
  CODIGO_EQ VARCHAR2(3) NOT NULL,
  ROL CHAR(2) NOT NULL, 
  CONSTRAINT PERTENECE_PK PRIMARY KEY (ANO, COD_BIKER),
  CONSTRAINT PERTENECE_TEMPORADAS_FK FOREIGN KEY (ANO) REFERENCES TEMPORADA (ANO),
  CONSTRAINT PERTENECE_BIKERS_FK FOREIGN KEY (COD_BIKER) REFERENCES BIKER (COD_BIKER),
  CONSTRAINT PERTENECE_EQUIPOS_FK FOREIGN KEY (CODIGO_EQ) REFERENCES EQUIPO (CODIGO_EQ),
  CONSTRAINT ROL_CHK CHECK (ROL IN ('LI', 'GR')) -- LI: Lider, GR: Gregario.
);

INSERT INTO PERTENECE (ANO, COD_BIKER, CODIGO_EQ, ROL) VALUES (2018, 1, 'CON', 'LI');
INSERT INTO PERTENECE (ANO, COD_BIKER, CODIGO_EQ, ROL) VALUES (2019, 1, 'POW', 'LI');
INSERT INTO PERTENECE (ANO, COD_BIKER, CODIGO_EQ, ROL) VALUES (2018, 2, 'SAR', 'LI');
INSERT INTO PERTENECE (ANO, COD_BIKER, CODIGO_EQ, ROL) VALUES (2019, 2, 'SAR', 'LI');
INSERT INTO PERTENECE (ANO, COD_BIKER, CODIGO_EQ, ROL) VALUES (2018, 3, 'EDE', 'GR');
INSERT INTO PERTENECE (ANO, COD_BIKER, CODIGO_EQ, ROL) VALUES (2019, 3, 'SAR', 'LI');
INSERT INTO PERTENECE (ANO, COD_BIKER, CODIGO_EQ, ROL) VALUES (2018, 4, 'EDE', 'GR');
INSERT INTO PERTENECE (ANO, COD_BIKER, CODIGO_EQ, ROL) VALUES (2019, 4, 'CON', 'LI');
INSERT INTO PERTENECE (ANO, COD_BIKER, CODIGO_EQ, ROL) VALUES (2018, 5, 'EDE', 'LI');
INSERT INTO PERTENECE (ANO, COD_BIKER, CODIGO_EQ, ROL) VALUES (2019, 5, 'EDE', 'LI');
INSERT INTO PERTENECE (ANO, COD_BIKER, CODIGO_EQ, ROL) VALUES (2018, 6, 'SAR', 'GR');
INSERT INTO PERTENECE (ANO, COD_BIKER, CODIGO_EQ, ROL) VALUES (2019, 6, 'CON', 'LI');

-- PARTICIPA
CREATE TABLE PARTICIPA (
  FECHA_CARRERA DATE NOT NULL,
  COD_BIKER NUMBER NOT NULL, 
  POSICION_LLEGADA NUMBER NOT NULL,
  TIEMPO_LLEGADA NUMBER,
  CONSTRAINT PARTICIPA_PK PRIMARY KEY (FECHA_CARRERA, COD_BIKER),
  CONSTRAINT PARTICIPA_CARRERAS_FK FOREIGN KEY (FECHA_CARRERA) REFERENCES CARRERA (FECHA_CARRERA),
  CONSTRAINT PARTICIPA_BIKERS_FK FOREIGN KEY (COD_BIKER) REFERENCES BIKER (COD_BIKER),
  CONSTRAINT POSICION_LLEGADA_CHK CHECK (POSICION_LLEGADA > 0)
);

INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('14/10/2018',1,1,5024);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('14/10/2018',3,18,5909);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('21/10/2018',1,24,6396);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('21/10/2018',2,1,5129);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('21/10/2018',3,5,5542);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA) VALUES ('21/10/2018',4,31);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('22/09/2019',1,1,5610);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('22/09/2019',2,3,5729);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('22/09/2019',3,5,5831);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('22/09/2019',4,4,5776);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('22/09/2019',5,1,4207);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('29/09/2019',1,1,4945);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('29/09/2019',2,2,5048);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('29/09/2019',3,4,5070);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('29/09/2019',4,8,5119);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('27/10/2019',1,1,4444);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('27/10/2019',2,2,4563);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('27/10/2019',3,6,4708);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('27/10/2019',4,3,4579);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('27/10/2019',5,1,3526);
INSERT INTO PARTICIPA (FECHA_CARRERA,COD_BIKER,POSICION_LLEGADA,TIEMPO_LLEGADA) VALUES ('27/10/2019',6,2,3781);
commit;
